#!/bin/bash

# Define the repository URL
repo_url="https://github.com/example/repository.git"

# Clone the repository to a temporary directory
tmp_dir=$(mktemp -d)
git clone "$repo_url" "$tmp_dir"

# Change directory to the cloned repository
cd "$tmp_dir" || exit

# Iterate over all branches in the repository
git for-each-ref --format='%(refname:short)' refs/heads | while read -r branch; do
    # Create a ZIP file for the branch
    git archive --format=zip --output="/path/to/download/${branch}.zip" "$branch"
done

# Clean up: remove the temporary directory
rm -rf "$tmp_dir"

import org.eclipse.jgit.api.Git;
import org.eclipse.jgit.api.errors.GitAPIException;
import org.eclipse.jgit.internal.storage.file.FileRepository;
import org.eclipse.jgit.lib.Repository;
import org.eclipse.jgit.revwalk.RevCommit;
import org.eclipse.jgit.revwalk.RevWalk;
import org.eclipse.jgit.treewalk.TreeWalk;
import java.io.File;
import java.io.FileOutputStream;
import java.io.IOException;
import java.util.ArrayList;
import java.util.List;

public class GitDownloader {

    public static void main(String[] args) {
        String repoURL = "https://github.com/example/repository.git";
        String downloadPath = "/path/to/download";
        try {
            downloadRepoAsZip(repoURL, downloadPath);
        } catch (IOException | GitAPIException e) {
            e.printStackTrace();
        }
    }

    public static void downloadRepoAsZip(String repoURL, String downloadPath) throws IOException, GitAPIException {
        Git.cloneRepository()
                .setURI(repoURL)
                .setDirectory(new File(downloadPath))
                .call();

        try (Repository repo = new FileRepository(downloadPath + "/.git")) {
            try (Git git = new Git(repo)) {
                List<String> branches = getAllBranches(git);
                for (String branch : branches) {
                    checkoutBranch(git, branch);
                    createZip(downloadPath, branch);
                }
            }
        }
    }

    public static List<String> getAllBranches(Git git) throws GitAPIException {
        List<String> branches = new ArrayList<>();
        git.branchList().call().forEach(ref -> branches.add(ref.getName()));
        return branches;
    }

    public static void checkoutBranch(Git git, String branch) throws GitAPIException {
        git.checkout().setName(branch).call();
    }

    public static void createZip(String downloadPath, String branch) throws IOException {
        String zipFileName = downloadPath + "/" + branch + ".zip";
        File zipFile = new File(zipFileName);

        try (FileOutputStream fos = new FileOutputStream(zipFile)) {
            // Logic to create a zip file from the contents of the repository folder
            // You can use any library to create zip files, like java.util.zip or Apache Commons Compress
            // For simplicity, this example doesn't include the actual zip creation logic
        }
    }
}

